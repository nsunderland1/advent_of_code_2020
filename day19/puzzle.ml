open Core;;
let (=) = Poly.(=)
let (<>) = Poly.(<>)

let ignore_empty_lines = true

let parse_line line =
  let open Angstrom in
  let rule26 = string "b" in
  let rule132 = string "a" in
  let rule127 = ((list [rule132;rule132])<|>(list [rule132;rule26])) >>| String.concat in
  let rule49 = ((list [rule132;rule26])) >>| String.concat in
  let rule66 = ((list [rule26;rule127])<|>(list [rule132;rule49])) >>| String.concat in
  let rule82 = ((list [rule26;rule132])) >>| String.concat in
  let rule39 = ((list [rule49;rule26])<|>(list [rule82;rule132])) >>| String.concat in
  let rule135 = ((list [rule132;rule132])<|>(list [rule26;rule132])) >>| String.concat in
  let rule43 = ((list [rule132])<|>(list [rule26])) >>| String.concat in
  let rule16 = ((list [rule26;rule132])<|>(list [rule43;rule26])) >>| String.concat in
  let rule105 = ((list [rule135;rule26])<|>(list [rule16;rule132])) >>| String.concat in
  let rule116 = ((list [rule39;rule26])<|>(list [rule105;rule132])) >>| String.concat in
  let rule5 = ((list [rule132;rule132])<|>(list [rule26;rule26])) >>| String.concat in
  let rule24 = ((list [rule43;rule26])<|>(list [rule132;rule132])) >>| String.concat in
  let rule125 = ((list [rule26;rule5])<|>(list [rule132;rule24])) >>| String.concat in
  let rule21 = ((list [rule132;rule132])) >>| String.concat in
  let rule12 = ((list [rule132;rule21])) >>| String.concat in
  let rule110 = ((list [rule125;rule26])<|>(list [rule12;rule132])) >>| String.concat in
  let rule33 = ((list [rule132;rule116])<|>(list [rule26;rule110])) >>| String.concat in
  let rule106 = ((list [rule26;rule49])<|>(list [rule132;rule21])) >>| String.concat in
  let rule35 = ((list [rule26;rule12])<|>(list [rule132;rule106])) >>| String.concat in
  let rule81 = ((list [rule26;rule16])<|>(list [rule132;rule21])) >>| String.concat in
  let rule18 = ((list [rule82;rule26])<|>(list [rule135;rule132])) >>| String.concat in
  let rule47 = ((list [rule81;rule26])<|>(list [rule18;rule132])) >>| String.concat in
  let rule109 = ((list [rule132;rule35])<|>(list [rule26;rule47])) >>| String.concat in
  let rule99 = ((list [rule132;rule33])<|>(list [rule26;rule109])) >>| String.concat in
  let rule103 = ((list [rule132;rule127])<|>(list [rule26;rule5])) >>| String.concat in
  let rule130 = ((list [rule103;rule132])<|>(list [rule66;rule26])) >>| String.concat in
  let rule3 = ((list [rule132;rule43])<|>(list [rule26;rule132])) >>| String.concat in
  let rule111 = ((list [rule132;rule127])<|>(list [rule26;rule3])) >>| String.concat in
  let rule63 = ((list [rule26;rule135])<|>(list [rule132;rule127])) >>| String.concat in
  let rule83 = ((list [rule111;rule26])<|>(list [rule63;rule132])) >>| String.concat in
  let rule34 = ((list [rule132;rule130])<|>(list [rule26;rule83])) >>| String.concat in
  let rule126 = ((list [rule26;rule16])<|>(list [rule132;rule49])) >>| String.concat in
  let rule1 = ((list [rule132;rule26])<|>(list [rule26;rule132])) >>| String.concat in
  let rule95 = ((list [rule135;rule132])<|>(list [rule1;rule26])) >>| String.concat in
  let rule74 = ((list [rule132;rule126])<|>(list [rule26;rule95])) >>| String.concat in
  let rule131 = ((list [rule127;rule26])<|>(list [rule135;rule132])) >>| String.concat in
  let rule133 = ((list [rule132;rule5])<|>(list [rule26;rule1])) >>| String.concat in
  let rule101 = ((list [rule132;rule131])<|>(list [rule26;rule133])) >>| String.concat in
  let rule114 = ((list [rule74;rule26])<|>(list [rule101;rule132])) >>| String.concat in
  let rule100 = ((list [rule26;rule34])<|>(list [rule132;rule114])) >>| String.concat in
  let rule65 = ((list [rule99;rule132])<|>(list [rule100;rule26])) >>| String.concat in
  let rule40 = ((list [rule1;rule26])<|>(list [rule16;rule132])) >>| String.concat in
  let rule87 = ((list [rule16;rule26])<|>(list [rule49;rule132])) >>| String.concat in
  let rule58 = ((list [rule43;rule132])<|>(list [rule26;rule26])) >>| String.concat in
  let rule118 = ((list [rule82;rule26])<|>(list [rule58;rule132])) >>| String.concat in
  let rule57 = ((list [rule132;rule118])<|>(list [rule26;rule125])) >>| String.concat in
  let rule93 = ((list [rule26;rule26])) >>| String.concat in
  let rule73 = ((list [rule93;rule132])<|>(list [rule93;rule26])) >>| String.concat in
  let rule107 = ((list [rule26;rule73])<|>(list [rule132;rule131])) >>| String.concat in
  let rule124 = ((list [rule132;rule57])<|>(list [rule26;rule107])) >>| String.concat in
  let rule53 = ((list [rule43;rule43])) >>| String.concat in
  let rule80 = ((list [rule1;rule26])<|>(list [rule53;rule132])) >>| String.concat in
  let rule52 = ((list [rule26;rule24])) >>| String.concat in
  let rule72 = ((list [rule49;rule26])<|>(list [rule16;rule132])) >>| String.concat in
  let rule25 = ((list [rule49;rule26])<|>(list [rule21;rule132])) >>| String.concat in
  let rule134 = ((list [rule132;rule21])<|>(list [rule26;rule93])) >>| String.concat in
  let rule113 = ((list [rule25;rule26])<|>(list [rule134;rule132])) >>| String.concat in
  let rule50 = ((list [rule26;rule21])<|>(list [rule132;rule135])) >>| String.concat in
  let rule123 = ((list [rule73;rule132])<|>(list [rule80;rule26])) >>| String.concat in
  let rule108 = ((list [rule26;rule93])<|>(list [rule132;rule93])) >>| String.concat in
  let rule94 = ((list [rule132;rule127])<|>(list [rule26;rule49])) >>| String.concat in
  let rule14 = ((list [rule108;rule26])<|>(list [rule94;rule132])) >>| String.concat in
  let rule78 = ((list [rule132;rule123])<|>(list [rule26;rule14])) >>| String.concat in
  let rule104 = ((list [rule132;rule26])<|>(list [rule26;rule26])) >>| String.concat in
  let rule88 = ((list [rule3;rule132])<|>(list [rule127;rule26])) >>| String.concat in
  let rule90 = ((list [rule82;rule26])<|>(list [rule16;rule132])) >>| String.concat in
  let rule96 = ((list [rule104;rule26])<|>(list [rule16;rule132])) >>| String.concat in
  let rule98 = ((list [rule24;rule26])<|>(list [rule104;rule132])) >>| String.concat in
  let rule27 = ((list [rule5;rule132])<|>(list [rule127;rule26])) >>| String.concat in
  let rule91 = ((list [rule93;rule26])<|>(list [rule135;rule132])) >>| String.concat in
  let rule22 = ((list [rule132;rule1])<|>(list [rule26;rule49])) >>| String.concat in
  let rule120 = ((list [rule80;rule132])<|>(list [rule81;rule26])) >>| String.concat in
  let rule54 = ((list [rule135;rule26])<|>(list [rule53;rule132])) >>| String.concat in
  let rule70 = ((list [rule96;rule132])<|>(list [rule54;rule26])) >>| String.concat in
  let rule85 = ((list [rule135;rule132])) >>| String.concat in
  let rule64 = ((list [rule104;rule43])) >>| String.concat in
  let rule19 = ((list [rule26;rule85])<|>(list [rule132;rule64])) >>| String.concat in
  let rule60 = ((list [rule70;rule132])<|>(list [rule19;rule26])) >>| String.concat in
  let rule10 = ((list [rule26;rule60])<|>(list [rule132;rule124])) >>| String.concat in
  let rule92 = ((list [rule53;rule26])<|>(list [rule93;rule132])) >>| String.concat in
  let rule29 = ((list [rule3;rule26])<|>(list [rule104;rule132])) >>| String.concat in
  let rule4 = ((list [rule132;rule92])<|>(list [rule26;rule29])) >>| String.concat in
  let rule61 = ((list [rule16;rule132])<|>(list [rule3;rule26])) >>| String.concat in
  let rule41 = ((list [rule58;rule26])<|>(list [rule16;rule132])) >>| String.concat in
  let rule30 = ((list [rule61;rule132])<|>(list [rule41;rule26])) >>| String.concat in
  let rule76 = ((list [rule4;rule26])<|>(list [rule30;rule132])) >>| String.concat in
  let rule37 = ((list [rule82;rule132])<|>(list [rule58;rule26])) >>| String.concat in
  let rule32 = ((list [rule24;rule132])<|>(list [rule53;rule26])) >>| String.concat in
  let rule9 = ((list [rule132;rule37])<|>(list [rule26;rule32])) >>| String.concat in
  let rule13 = ((list [rule26;rule58])<|>(list [rule132;rule5])) >>| String.concat in
  let rule122 = ((list [rule26;rule127])<|>(list [rule132;rule93])) >>| String.concat in
  let rule89 = ((list [rule13;rule26])<|>(list [rule122;rule132])) >>| String.concat in
  let rule68 = ((list [rule9;rule26])<|>(list [rule89;rule132])) >>| String.concat in
  let rule7 = ((list [rule26;rule76])<|>(list [rule132;rule68])) >>| String.concat in
  let rule97 = ((list [rule132;rule7])<|>(list [rule26;rule10])) >>| String.concat in
  let rule2 = ((list [rule26;rule1])<|>(list [rule132;rule24])) >>| String.concat in
  let rule55 = ((list [rule37;rule26])<|>(list [rule2;rule132])) >>| String.concat in
  let rule59 = ((list [rule1;rule26])<|>(list [rule93;rule132])) >>| String.concat in
  let rule20 = ((list [rule132;rule59])<|>(list [rule26;rule105])) >>| String.concat in
  let rule62 = ((list [rule132;rule55])<|>(list [rule26;rule20])) >>| String.concat in
  let rule23 = ((list [rule132;rule52])<|>(list [rule26;rule88])) >>| String.concat in
  let rule36 = ((list [rule26;rule120])<|>(list [rule132;rule23])) >>| String.concat in
  let rule119 = ((list [rule132;rule62])<|>(list [rule26;rule36])) >>| String.concat in
  let rule17 = ((list [rule49;rule26])<|>(list [rule24;rule132])) >>| String.concat in
  let rule67 = ((list [rule26;rule58])<|>(list [rule132;rule53])) >>| String.concat in
  let rule112 = ((list [rule26;rule67])<|>(list [rule132;rule90])) >>| String.concat in
  let rule128 = ((list [rule58;rule132])<|>(list [rule53;rule26])) >>| String.concat in
  let rule115 = ((list [rule26;rule128])<|>(list [rule132;rule72])) >>| String.concat in
  let rule71 = ((list [rule26;rule112])<|>(list [rule132;rule115])) >>| String.concat in
  let rule6 = ((list [rule26;rule21])<|>(list [rule132;rule16])) >>| String.concat in
  let rule15 = ((list [rule98;rule132])<|>(list [rule6;rule26])) >>| String.concat in
  let rule45 = ((list [rule132;rule27])<|>(list [rule26;rule40])) >>| String.concat in
  let rule44 = ((list [rule24;rule132])<|>(list [rule5;rule26])) >>| String.concat in
  let rule69 = ((list [rule22;rule26])<|>(list [rule44;rule132])) >>| String.concat in
  let rule56 = ((list [rule132;rule69])<|>(list [rule26;rule113])) >>| String.concat in
  let rule42 = ((list [rule97;rule132])<|>(list [rule65;rule26])) >>| String.concat in
  let rule8 = (many1 rule42 >>| String.concat) in
  let rule79 = ((list [rule49;rule132])<|>(list [rule104;rule26])) >>| String.concat in
  let rule28 = ((list [rule79;rule26])<|>(list [rule87;rule132])) >>| String.concat in
  let rule48 = ((list [rule15;rule132])<|>(list [rule28;rule26])) >>| String.concat in
  let rule84 = ((list [rule26;rule48])<|>(list [rule132;rule71])) >>| String.concat in
  let rule129 = ((list [rule132;rule50])<|>(list [rule26;rule91])) >>| String.concat in
  let rule75 = ((list [rule82;rule132])) >>| String.concat in
  let rule121 = ((list [rule132;rule17])<|>(list [rule26;rule75])) >>| String.concat in
  let rule136 = ((list [rule26;rule129])<|>(list [rule132;rule121])) >>| String.concat in
  let rule117 = ((list [rule56;rule132])<|>(list [rule136;rule26])) >>| String.concat in
  let rule86 = ((list [rule26;rule104])<|>(list [rule132;rule135])) >>| String.concat in
  let rule137 = ((list [rule132;rule135])<|>(list [rule26;rule53])) >>| String.concat in
  let rule51 = ((list [rule86;rule132])<|>(list [rule137;rule26])) >>| String.concat in
  let rule38 = ((list [rule26;rule84])<|>(list [rule132;rule119])) >>| String.concat in
  let rule46 = ((list [rule132;rule45])<|>(list [rule26;rule51])) >>| String.concat in
  let rule102 = ((list [rule78;rule132])<|>(list [rule46;rule26])) >>| String.concat in
  let rule77 = ((list [rule132;rule117])<|>(list [rule26;rule102])) >>| String.concat in
  let rule31 = ((list [rule38;rule26])<|>(list [rule77;rule132])) >>| String.concat in
  let rule11 = fix (fun rule11 -> ((list [rule42;rule11;rule31])<|>(list [rule8])) >>| String.concat) in
  let rule0 = ((list [rule11])) >>| String.concat in
  parse_string ~consume:All rule0 line

let int_out some_int =
  print_endline "";
  Out_channel.output_string stdout (string_of_int some_int)

let _ =
  let lines = In_channel.read_lines "inputtext" in
  let lines = if ignore_empty_lines then List.filter ~f:(fun line -> not (phys_equal line "")) lines else lines in
  let data = List.map ~f:parse_line lines in
  List.iter ~f:(function Error s -> print_endline s | _ -> ()) data;
  let count = List.count ~f:Result.is_ok data in
  int_out count  
